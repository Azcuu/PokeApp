<div class="pokedex-container">
  <h1>Pok√©dex</h1>

  <!-- Estado de carga -->
  <div *ngIf="loading()" class="loading">
    <div class="spinner"></div>
    <p>Cargando Pok√©mon...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error() && !loading()" class="error">
    <h2>üòû Error</h2>
    <p>{{ error() }}</p>
    <button (click)="refresh()">Reintentar</button>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="!loading() && !error() && loaded()" class="pokedex-content">

    <!-- Filtros -->
    <div class="filters-section">
      <div class="search-box">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          placeholder="Buscar Pok√©mon por nombre..."
          class="search-input"
        >
        <span class="search-icon">üîç</span>
      </div>

      <div class="type-filter">
        <select
          [(ngModel)]="selectedType"
          class="type-select"
        >
          <option value="">Todos los tipos</option>
          <option *ngFor="let type of pokemonTypes" [value]="type">
            {{ type }}
          </option>
        </select>

        <button
          *ngIf="searchTerm() || selectedType()"
          (click)="clearFilters()"
          class="clear-btn"
        >
          Limpiar filtros
        </button>
      </div>

      <div class="stats">
        <span class="total-count">
          Mostrando {{ filteredPokemons().length }} de {{ pokemons().length }} Pok√©mon
        </span>
      </div>
    </div>

    <!-- Grid de Pok√©mon -->
    <div class="pokemon-grid" *ngIf="filteredPokemons().length > 0">
      <div
        *ngFor="let pokemon of filteredPokemons()"
        class="pokemon-card"
        [class]="'type-' + getPrimaryType(pokemon)"
        (click)="goToDetail(pokemon.id)"
      >
        <div class="card-header">
          <span class="pokemon-id">#{{ formatId(pokemon.id) }}</span>
          <div class="type-badges">
            <span
              *ngFor="let type of pokemon.type"
              class="type-badge"
            >
              {{ type }}
            </span>
          </div>
        </div>

        <div class="pokemon-image">
          <img
            [src]="pokemon.image.thumbnail || pokemon.image.sprite"
            [alt]="pokemon.name.english"
            class="pokemon-sprite"
            referrerpolicy="no-referrer"
            (error)="onImageError($event)"
          >
        </div>

        <div class="pokemon-info">
          <h3 class="pokemon-name">{{ pokemon.name.english }}</h3>
          <p class="pokemon-japanese">{{ pokemon.name.japanese }}</p>
        </div>
      </div>
    </div>

    <!-- Sin resultados -->
    <div *ngIf="filteredPokemons().length === 0 && !loading()" class="no-results">
      <p>No se encontraron Pok√©mon con los filtros aplicados.</p>
      <button (click)="clearFilters()">Mostrar todos</button>
    </div>
  </div>
</div>
